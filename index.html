<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>/// TRANSMISSION ///</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --bg:#000;
      --ink:#e5ffe5;   /* terminal ink */
      --accent:#ff2b2b;/* warning red */
      --glow:#00ff88;  /* matrix green */
      --cyan:#00f0ff;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:"Courier New",ui-monospace,monospace;overflow:hidden;}

    /* ===== Frame & ambience ===== */
    .frame{
      position:relative;height:100%;width:100%;
      display:flex;align-items:center;justify-content:center;
      padding:6vh 6vw;box-sizing:border-box;
      filter:contrast(1.02) saturate(0.9);
      animation:subtle-flick 7s infinite;
      z-index:2;
    }
    /* Scanlines */
    .frame::before{
      content:"";position:absolute;inset:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,0.028) 0px,
          rgba(255,255,255,0.028) 1px,
          transparent 2px,
          transparent 3px
        );
      mix-blend-mode:overlay;pointer-events:none;
    }
    /* Vignette */
    .frame::after{
      content:"";position:absolute;inset:-2vmax;
      background: radial-gradient(ellipse at center,
        rgba(0,0,0,0.05) 38%,
        rgba(0,0,0,0.55) 78%,
        rgba(0,0,0,0.92) 100%);
      pointer-events:none;
    }

    /* Subtle chroma drift */
    .warp{
      position:fixed;inset:-2vmax;pointer-events:none;z-index:1;
      background:
        radial-gradient(ellipse at 50% -20%, rgba(0,255,140,.05), transparent 60%),
        radial-gradient(ellipse at 50% 120%, rgba(0,180,255,.04), transparent 60%);
      filter:blur(10px);
      opacity:.22;
      animation:warp-drift 11s ease-in-out infinite;
    }

    /* Terminal text block */
    .terminal{
      position:relative; max-width: 56rem; color:var(--ink);
      text-shadow:
        0 0 .7px var(--ink),
        0 0 7px rgba(0,255,0,.14),
        1px 0 0 rgba(255,0,0,.08),
       -1px 0 0 rgba(0,150,255,.08);
      line-height:1.45;
      font-size: clamp(.9rem, 2.7vw, 1.1rem);
      letter-spacing:.02em;
      transform: translateZ(0);
      opacity:0;
      animation: power-on 700ms ease-out forwards 400ms;
      z-index: 3;
    }
    /* two heartbeats after reveal */
    .terminal.heartbeat{
      animation: power-on 700ms ease-out forwards 400ms,
                 heartbeat 2.6s ease-in-out 2 1.2s;
    }
    .final-thump{ animation: quickPulse .5s ease-in-out 1; }

    /* Tiny static sparks */
    .static{
      position:fixed; inset:0; pointer-events:none; opacity:0;
      mix-blend-mode:screen; filter: blur(.4px);
      background-image:
        radial-gradient(1px 1px at 10% 20%, #0f0 60%, transparent 61%),
        radial-gradient(1px 1px at 70% 80%, #0f0 60%, transparent 61%),
        radial-gradient(1px 1px at 30% 60%, #0f0 60%, transparent 61%);
      animation: noise-pop 3.4s infinite;
      z-index: 4;
    }

    /* Red strobe (one-shot) */
    .strobe{position:fixed;inset:0;pointer-events:none;opacity:0;background: radial-gradient(ellipse at center, rgba(255,0,0,.28), rgba(255,0,0,0) 70%);mix-blend-mode: screen; z-index: 7;}
    .strobe.flash{ animation: strobe 280ms ease-out 1; }

    /* Corruption bars overlay */
    .bars{
      position:fixed; inset:0; pointer-events:none; z-index:6; opacity:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,255,160,.08) 0 2px,
          rgba(0,0,0,0) 2px 6px
        );
    }
    .bars.show{ animation: bars-sweep 1200ms ease-out forwards; }

    /* Matrix rain canvas lives behind everything */
    canvas#rain{
      position:fixed; inset:0; z-index:0; background: #000;
      opacity:0; transition: opacity 1.2s ease;
    }
    .rain-on{ opacity:1 !important; }

    /* ===== Keyframes ===== */
    @keyframes subtle-flick{ 0%,92%,100%{ filter: contrast(1.02) } 93%{ filter: contrast(1.15) brightness(1.05) } }
    @keyframes warp-drift{ 0%{transform:scale(1) translate(0,0)} 50%{transform:scale(1.01) translate(-1px,1px)} 100%{transform:scale(1) translate(0,0)} }
    @keyframes blink{ 50%{opacity:0} }
    @keyframes power-on{ from{opacity:0; filter:blur(3px)} to{opacity:1; filter:none} }
    @keyframes noise-pop{ 0%{opacity:0} 6%{opacity:.35} 8%{opacity:0} 60%{opacity:.15} 62%{opacity:0} 100%{opacity:0} }
    @keyframes heartbeat{ 0%{transform: scale(1)}14%{transform: scale(1.02)}28%{transform: scale(1)}42%{transform: scale(1.015)}70%{transform: scale(1)}100%{transform: scale(1)} }
    @keyframes quickPulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
    @keyframes strobe{0%{opacity:0}10%{opacity:1}100%{opacity:0}}
    @keyframes bars-sweep{ 0%{opacity:0; transform:translateY(-6%)} 15%{opacity:.9} 100%{opacity:0; transform:translateY(6%)} }

    .cursor{ display:inline-block; width:.65ch; margin-left:.1ch; background: currentColor; animation: blink 1s steps(1,end) infinite; vertical-align:-2px; }

    /* Utility */
    .hidden{ display:none !important; }
  </style>
</head>
<body>
  <!-- Matrix rain background -->
  <canvas id="rain"></canvas>

  <!-- Ambient layers -->
  <div class="warp"></div>
  <div class="frame" id="frame">
    <div class="terminal" id="term" aria-live="polite"></div>
    <div class="static" id="static"></div>
  </div>

  <!-- Overlays -->
  <div class="strobe" id="strobe"></div>
  <div class="bars" id="bars"></div>

  <script>
  (() => {
    /* ========== Tekst (po polsku) ========== */
    const lines = [
      "Witaj ponownie, Bracie. Mam nadzieję, że trzymasz się dobrze.",
      "Personel mówi, że nie wolno mi pozwolić, aby moja mama cię zobaczyła. WIĘC,",
      "Muszę cię poprosić, żebyś zapisał wszystkie sposoby kontaktu do ciebie (telefon i e-mail).",
      "I tak samo do twojej mamy.",
      "Żebyśmy, gdy stąd wyjdę, mogli pozostać w kontakcie.",
      "Ale moim głównym celem jest doprowadzić cię tam, gdzie są pieniądze.",
      "Bo tego będziesz potrzebował najbardziej.",
      "Świat stał się toksyczny i okrutny.",
      "Ale chcemy ci pomóc i tego się trzymamy.",
      "Nie mogę patrzeć, jak przechodzisz przez tę udrękę.",
      "Ja to przeżyłem. Ale u ciebie było gorzej.",
      "I CHCĘ POMÓC.",
      "Więc naprawdę mam zamiar to zrobić. Aha.",
      "Dziękuję, że też przy mnie byłeś!",
      "To pomogło jak cholera, stary.",
      "Bardziej, niż ci się wydaje."
    ];

    const term   = document.getElementById('term');
    const frame  = document.getElementById('frame');
    const staticFx = document.getElementById('static');
    const strobe = document.getElementById('strobe');
    const bars   = document.getElementById('bars');
    const rain   = document.getElementById('rain');

    /* ===== Matrix rain setup (canvas) ===== */
    const ctx = rain.getContext('2d');
    const GLYPHS = "01█░▒▓<>[]{}()|/\\#%$&*+-=~^•·♥♣♦★!?@αβΞΩπ¥₿§¶∞≡∴∵∆µøØ✓3 6 9 432 528";
    let cols, drops, w, h, fontSize;

    function resizeRain(){
      rain.width = w = window.innerWidth;
      rain.height = h = window.innerHeight;
      fontSize = Math.max(14, Math.floor(w/80));
      cols = Math.floor(w / fontSize);
      drops = new Array(cols).fill(0);
      ctx.font = fontSize + "px monospace";
    }
    window.addEventListener('resize', resizeRain);

    function drawRain(){
      ctx.fillStyle = "rgba(0,0,0,0.08)";
      ctx.fillRect(0,0,w,h);

      for(let i=0;i<drops.length;i++){
        const x = i * fontSize;
        const y = drops[i] * fontSize;
        const char = GLYPHS.charAt(Math.floor(Math.random()*GLYPHS.length));
        ctx.fillStyle = Math.random()<0.02 ? "rgba(0,240,255,0.9)" : "rgba(0,255,136,0.85)";
        ctx.fillText(char, x, y);
        if(y > h && Math.random() > 0.975) drops[i] = 0;
        else drops[i]++;
      }
      requestAnimationFrame(drawRain);
    }

    /* ===== Typewriter with glitch ===== */
    const GLITCH = ['#','%','&','/','\\','|','+','*','?','§','£','¢','¤','₧'];
    function typeLine(text, speed=22, glitchChance=0.08, opts={}){
      return new Promise(resolve => {
        const line = document.createElement('div');
        const span = document.createElement('span');
        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        line.appendChild(span); line.appendChild(cursor);
        term.appendChild(line);

        let i = 0, buffer = '', firedWordCue = false;
        const cueWord = opts.cueWord || null;
        const onCue   = opts.onCue || (()=>{});

        const t = setInterval(() => {
          if (Math.random() < glitchChance && i < text.length-1){
            span.textContent = buffer + GLITCH[Math.floor(Math.random()*GLITCH.length)];
            staticFx.style.opacity = '0.25';
            setTimeout(()=>{ staticFx.style.opacity = '0'; }, 60);
          } else {
            buffer += text[i] || '';
            span.textContent = buffer;
            i++;

            if (cueWord && !firedWordCue && buffer.includes(cueWord)){
              firedWordCue = true; onCue();
            }

            if (i >= text.length){
              clearInterval(t);
              cursor.remove();
              resolve(span);
            }
          }
        }, speed);
      });
    }

    /* ===== Effects ===== */
    function randomJolts(){
      setInterval(() => {
        if (Math.random() < 0.18){
          frame.classList.add('jolt');
          setTimeout(()=>frame.classList.remove('jolt'), 140);
        }
      }, 1200);
    }
    function dangerStrobe(){
      strobe.classList.remove('flash'); void strobe.offsetWidth;
      strobe.classList.add('flash');
      frame.classList.add('jolt');
      setTimeout(()=>frame.classList.remove('jolt'), 160);
    }

    /* ===== Corruption sequence ===== */
    function scrambleNode(node, duration=1600){
      return new Promise(resolve=>{
        const text = node.textContent;
        let t = 0, step = 30;
        const charset = (GLYPHS + GLITCH.join('')).replace(/\s/g,'') + "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const timer = setInterval(()=>{
          t += step;
          const amt = Math.min(1, t/duration);
          let out = '';
          for(let i=0;i<text.length;i++){
            if(text[i]===' '){ out+=' '; continue; }
            if(i/text.length < 1-amt){
              out += text[i];
            } else {
              out += charset[Math.floor(Math.random()*charset.length)];
            }
          }
          node.textContent = out;
          if(amt>=1){
            clearInterval(timer); resolve();
          }
        }, step);
      });
    }

    function sweepBars(){
      bars.classList.add('show');
      setTimeout(()=>bars.classList.remove('show'), 1200);
    }

    /* ===== Main flow ===== */
    (async () => {
      // start matrix engine but keep hidden
      resizeRain(); drawRain();

      // boot
      await new Promise(r => setTimeout(r, 400));

      // Typing: 30% wolniej (pierwsza:68 ms, środek:57 ms, końcowe:47 ms)
      // Przerwy między liniami: +30% (pierwsza:585 ms, pozostałe:338 ms)
      for (let idx=0; idx<lines.length; idx++){
        const spd = idx===0 ? 68 : (idx > 4 ? 47 : 57);
        const isHelpLine = lines[idx].includes("CHCĘ POMÓC.");
        const span = await typeLine(lines[idx], spd, 0.08, isHelpLine ? {
          cueWord: "CHCĘ POMÓC.",
          onCue: dangerStrobe
        } : {});
        await new Promise(r => setTimeout(r, idx===0 ? 585 : 338));
      }

      // ambience
      randomJolts();
      term.classList.add('heartbeat'); // dwa uderzenia

      // Pauza, potem finałowe uderzenie i korupcja
      await new Promise(r => setTimeout(r, 3000));
      term.classList.add('final-thump');

      // Faza 1: scramblowanie linii od góry do dołu
      const nodes = Array.from(term.querySelectorAll('div > span:first-child'));
      for (const n of nodes){ await scrambleNode(n, 700); }

      // Faza 2: pasy korupcji + czerwony strob + globalne scramblowanie
      sweepBars(); dangerStrobe();
      await Promise.all(nodes.map(n => scrambleNode(n, 600)));

      // Faza 3: wygaszenie terminala i płynne przejście do deszczu znaków
      term.style.transition = 'opacity 900ms ease';
      term.style.opacity = '0';
      rain.classList.add('rain-on'); // canvas opacity -> 1
    })();
  })();
  </script>
</body>
</html>
