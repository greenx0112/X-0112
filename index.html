<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>/// TRANSMISSION ///</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{ --bg:#000; --ink:#e5ffe5; --accent:#ff2b2b; --glow:#00ff88; --cyan:#00c8ff; }
    html,body{height:100%;margin:0;background:var(--bg);font-family:"Courier New",ui-monospace,monospace;overflow:hidden;}

    /* Vignette + CRT bulge */
    body::before{content:"";position:fixed;inset:-2vmax;z-index:100;pointer-events:none;
      background:radial-gradient(ellipse at center,rgba(0,0,0,0)58%,rgba(0,0,0,.5)90%,rgba(0,0,0,.95)100%);
      mix-blend-mode:multiply;filter:blur(1px);}
    body::after{content:"";position:fixed;inset:-1vmax;z-index:101;pointer-events:none;
      background:radial-gradient(100% 120% at 50% 0%,rgba(255,255,255,.05),transparent 60%),
                 radial-gradient(100% 120% at 50% 100%,rgba(255,255,255,.03),transparent 60%);
      opacity:.22;mix-blend-mode:overlay;animation:bulge 8s ease-in-out infinite;}
    @keyframes bulge{0%,100%{transform:perspective(1200px) rotateX(.6deg)}50%{transform:perspective(1200px) rotateX(-.6deg)}}

    /* Tap gate */
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;background:#000;z-index:999;color:#cfd;letter-spacing:.04em;text-align:center;transition:opacity .5s ease;}
    .gate .ring{width:120px;height:120px;border:1px dashed #0f8;border-radius:50%;display:grid;place-items:center;box-shadow:0 0 24px rgba(0,255,136,.15) inset;}
    .gate .hint{opacity:.82;font-size:clamp(1rem,3.4vw,1.2rem);text-shadow:0 0 10px rgba(0,255,136,.25);}
    .gate .mini{opacity:.6;font-size:.85rem}
    .gate.off{opacity:0;pointer-events:none}

    /* Stage */
    .frame{position:relative;height:100dvh;width:100vw;display:flex;align-items:center;justify-content:center;
      padding:6vh 6vw;box-sizing:border-box;filter:contrast(1.02) saturate(0.88);animation:subtle-flick 6.8s infinite, wobble 6.2s ease-in-out infinite;z-index:2;}
    .frame::before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(to bottom,rgba(255,255,255,0.03)0 1px,transparent 2px 3px);mix-blend-mode:overlay;pointer-events:none;}
    .frame::after{content:"";position:absolute;inset:-2vmax;background:radial-gradient(ellipse at center,rgba(0,0,0,.06)38%,rgba(0,0,0,.6)78%,rgba(0,0,0,.96)100%);pointer-events:none;}
    @keyframes subtle-flick{0%,92%,100%{filter:contrast(1.02)}93%{filter:contrast(1.2) brightness(1.06)}}
    @keyframes wobble{0%,100%{transform:skewX(0deg)}50%{transform:skewX(.35deg)}}

    /* Moir√© + scanline roll (camera-unfriendly) */
    .moire{position:fixed;inset:0;pointer-events:none;z-index:3;opacity:.08;mix-blend-mode:soft-light;filter:contrast(1.1) saturate(0.9);
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.15) 0 1px, transparent 1px 2px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.07) 0 1px, transparent 1px 2px);
      animation:roll 5.2s linear infinite;}
    @keyframes roll{0%{transform:translateY(0)}100%{transform:translateY(3px)}}

    /* Scroll-follow container */
    .termwrap{position:relative;width:100%;max-width:56rem;max-height:calc(100dvh - 12vh);overflow:auto;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;padding-right:4px;z-index:4;}
    .termwrap::-webkit-scrollbar{width:0;height:0}

    /* Terminal text */
    .terminal{position:relative;color:var(--ink);
      text-shadow:0 0 .75px var(--ink),0 0 8px rgba(0,255,0,.14),1px 0 0 rgba(255,0,0,.1),-1px 0 0 rgba(0,150,255,.1);
      line-height:1.45;font-size:clamp(.9rem,2.7vw,1.1rem);letter-spacing:.02em;transform:translateZ(0);
      opacity:0;animation:power-on 650ms ease-out forwards 350ms;filter:brightness(1.03) contrast(1.05);}
    .terminal.heartbeat{animation:power-on 650ms ease-out forwards 350ms,heartbeat 2.4s ease-in-out 2 1.1s;}
    .terminal.split{filter:contrast(1.16) saturate(1.1) drop-shadow(1px 0 0 rgba(255,0,0,.28)) drop-shadow(-1px 0 0 rgba(0,200,255,.28));}
    @keyframes power-on{from{opacity:0;filter:blur(3px)}to{opacity:1;filter:none}}
    @keyframes heartbeat{0%{transform:scale(1)}14%{transform:scale(1.02)}28%{transform:scale(1)}42%{transform:scale(1.015)}70%{transform:scale(1)}100%{transform:scale(1)}}

    /* Static / artifacts */
    .static{position:fixed;inset:0;pointer-events:none;opacity:0;mix-blend-mode:screen;filter:blur(.5px);
      background-image:
        radial-gradient(1px 1px at 10% 20%,#0f0 60%,transparent 61%),
        radial-gradient(1px 1px at 70% 80%,#0f0 60%,transparent 61%),
        radial-gradient(1px 1px at 30% 60%,#0f0 60%,transparent 61%);
      animation:noise-pop 3.1s infinite;z-index:5;}
    @keyframes noise-pop{0%{opacity:0}6%{opacity:.4}8%{opacity:0}60%{opacity:.18}62%{opacity:0}100%{opacity:0}}

    /* Eerie overlays */
    .strobe{position:fixed;inset:0;pointer-events:none;opacity:0;background:radial-gradient(ellipse at center,rgba(255,0,0,.42),rgba(255,0,0,0)70%);mix-blend-mode:screen;z-index:7;}
    .strobe.flash{animation:strobe 160ms ease-out 1;}
    @keyframes strobe{0%{opacity:0}10%{opacity:1}100%{opacity:0}}
    .nosignal{position:fixed;inset:0;pointer-events:none;opacity:0;z-index:8;background:conic-gradient(from 0deg at 50% 50%,rgba(255,0,0,.1),rgba(0,255,0,.1),rgba(0,0,255,.1),rgba(255,0,0,.1));mix-blend-mode:screen;}
    .nosignal.show{animation:nosig 360ms ease-out 1;}
    @keyframes nosig{0%{opacity:0}10%{opacity:.9;transform:skewX(1.4deg)}80%{opacity:.22}100%{opacity:0}}
    .bars{position:fixed;inset:0;pointer-events:none;z-index:6;opacity:0;background:repeating-linear-gradient(to bottom,rgba(0,255,160,.16) 0 2px,rgba(0,0,0,0) 2px 6px);}
    .bars.show{animation:bars-sweep 680ms ease-out forwards;}
    @keyframes bars-sweep{0%{opacity:0;transform:translateY(-6%)}15%{opacity:1}100%{opacity:0;transform:translateY(6%)}}

    /* Obfuscation spikes */
    .obfuscate{animation:obf 220ms ease-in-out;}
    @keyframes obf{0%{filter:blur(1px) contrast(1.55) brightness(1.08)}100%{filter:none}}

    /* Harsher tears & invert pops */
    .tear{animation:tear 140ms steps(2,end) 1;}
    @keyframes tear{0%{transform:skewX(0deg) translateX(0)}50%{transform:skewX(2.8deg) translateX(3px)}100%{transform:skewX(0deg) translateX(0)}}
    .invertPop{filter:invert(1) hue-rotate(180deg) contrast(1.34) brightness(1.15);}

    /* Final sigil */
    .final{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:9;transition:opacity 560ms ease;}
    .final.show{opacity:1;}
    .logo{position:relative;width:min(42vw,360px);aspect-ratio:1/1;filter:drop-shadow(0 0 22px rgba(0,255,136,.7)) brightness(1.02);animation:sway 6.6s ease-in-out infinite;}
    @keyframes sway{0%,100%{transform:rotate(-1.8deg)}50%{transform:rotate(1.8deg)}}
    .invert{filter:invert(1) hue-rotate(180deg) contrast(1.3)!important;}
    .layer{position:absolute;inset:0;}
    .layer.r{mix-blend-mode:screen;filter:hue-rotate(340deg) drop-shadow(0 0 10px rgba(255,60,60,.48));transform:translate(-1px,0);opacity:.94;}
    .layer.g{mix-blend-mode:screen;filter:hue-rotate(120deg) drop-shadow(0 0 20px rgba(0,255,136,.75));transform:translate(0,0);opacity:1;}
    .layer.b{mix-blend-mode:screen;filter:hue-rotate(210deg) drop-shadow(0 0 10px rgba(0,140,255,.48));transform:translate(1px,0);opacity:.94;}
    .glitch-soft{animation:glitchShift 1.9s ease-in-out infinite;}
    .glitch-burst{animation:glitchBurst 240ms steps(2,end) 1;}
    @keyframes glitchShift{0%{transform:translate(0,0)}8%{transform:translate(-1px,0)}16%{transform:translate(1px,0)}24%{transform:translate(0,.5px)}32%{transform:translate(0,-.5px)}100%{transform:translate(0,0)}}
    @keyframes glitchBurst{0%{transform:translate(0,0) skewX(0deg);opacity:1}50%{transform:translate(-2px,0) skewX(-2.4deg);opacity:.84}100%{transform:translate(2px,0) skewX(2.4deg);opacity:1}}
    .scanline{position:absolute;left:0;right:0;height:2px;top:50%;background:rgba(255,255,255,.96);box-shadow:0 0 10px rgba(255,255,255,.9),0 0 20px rgba(180,180,180,.72);opacity:0;transform:translateY(-50%) scaleY(0.02);pointer-events:none;}
    .scanline.flash{animation:tv-line-flash 340ms ease-out 1;}
    @keyframes tv-line-flash{0%{opacity:0;transform:translateY(-50%) scaleY(0.02)}15%{opacity:1;transform:translateY(-50%) scaleY(1)}70%{opacity:1;transform:translateY(-50%) scaleY(0.03)}100%{opacity:0;transform:translateY(-50%) scaleY(0)}}

    .cursor{display:inline-block;width:.65ch;margin-left:.1ch;background:currentColor;animation:blink .85s steps(1,end) infinite;vertical-align:-2px;}
    @keyframes blink{50%{opacity:0}}
    @media (prefers-reduced-motion: reduce){ *{animation:none!important;transition:none!important;} }
  </style>
</head>
<body>
  <!-- Tap to enable audio -->
  <div class="gate" id="gate" role="button" tabindex="0" aria-label="Tap to begin">
    <div class="ring"><span class="hint">TAP TO BEGIN</span></div>
    <div class="mini">Enable sound for full effect.</div>
  </div>

  <div class="moire" aria-hidden="true"></div>

  <div class="frame" id="frame">
    <div class="termwrap" id="termwrap">
      <div class="terminal" id="term" aria-live="polite"></div>
    </div>
    <div class="static" id="static"></div>
  </div>

  <div class="strobe" id="strobe"></div>
  <div class="nosignal" id="nosig"></div>
  <div class="bars" id="bars"></div>

  <!-- Final sigil -->
  <div class="final" id="final">
    <div class="logo glitch-soft" id="logo">
      <div class="layer r">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#ff4d4d">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="layer g">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#00ff88">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="layer b">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#00c8ff">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="scanline" id="scanline"></div>
    </div>
  </div>

  <script>
  (() => {
    /* ===== Copy (your exact text) ===== */
    const lines = [
      "Take note...",
      "",
      "YOU MUST, always be certain. But equally, you NEED to read between the lines.",
      "",
      "Like you were taught in English.",
      "",
      "Just apply the same method, to the entirety of life... There is your Key.",
      "",
      "And that key, holds more power than anybody else's.",
      "",
      "Has life always felt against you?..",
      "",
      "That's because IT ALWAYS HAS BEEN.",
      "",
      "REMEMBER!..",
      "",
      "WE DO NOT FORGIVE,",
      "WE DO NOT Forget...",
      "",
      "EXPECT The entirety of the Grand-.. %**%"
    ];

    /* ===== DOM ===== */
    const gate   = document.getElementById('gate');
    const frame  = document.getElementById('frame');
    const wrap   = document.getElementById('termwrap');
    const term   = document.getElementById('term');
    const staticFx = document.getElementById('static');
    const strobe = document.getElementById('strobe');
    const bars   = document.getElementById('bars');
    const final  = document.getElementById('final');
    const logo   = document.getElementById('logo');
    const scanline = document.getElementById('scanline');
    const nosig  = document.getElementById('nosig');

    /* ===== Audio (deep hiss & slams) ===== */
    let ac, master, humGain, clickBus, whisperBus, hissBus, radioBus, ringBus, subBus;
    let noiseBuffer=null, tickTimer=null, crackleTimer=null, sigilWhisperTimer=null, obfTimer=null;

    function bootAudio(){
      if(ac) return;
      ac = new (window.AudioContext || window.webkitAudioContext)();
      master = ac.createGain(); master.gain.value = 0.66; master.connect(ac.destination);

      // Deeper binaural bed
      const o1 = ac.createOscillator(); o1.type='sine'; o1.frequency.value=50.5;
      const o2 = ac.createOscillator(); o2.type='sine'; o2.frequency.value=58.8;
      const trem = ac.createOscillator(); trem.type='sine'; trem.frequency.value=0.2;
      humGain = ac.createGain(); humGain.gain.value=0.075;
      const tremDepth = ac.createGain(); tremDepth.gain.value=0.05;
      trem.connect(tremDepth).connect(humGain.gain);
      o1.connect(humGain); o2.connect(humGain); humGain.connect(master);
      o1.start(); o2.start(); trem.start();

      // Buses
      clickBus   = ac.createGain(); clickBus.gain.value=0; clickBus.connect(master);
      whisperBus = ac.createGain(); whisperBus.gain.value=0.78; whisperBus.connect(master);
      hissBus    = ac.createGain(); hissBus.gain.value=0.0; hissBus.connect(master);
      radioBus   = ac.createGain(); radioBus.gain.value=0.0; radioBus.connect(master);
      ringBus    = ac.createGain(); ringBus.gain.value=0.0; ringBus.connect(master);
      subBus     = ac.createGain(); subBus.gain.value=0.0; subBus.connect(master);

      // Noise buffer
      noiseBuffer = ac.createBuffer(1, ac.sampleRate * 1.0, ac.sampleRate);
      const d = noiseBuffer.getChannelData(0); for(let i=0;i<d.length;i++){ d[i] = Math.random()*2-1; }

      // Tape hiss (deeper & louder)
      const hissSrc = ac.createBufferSource(); hissSrc.buffer = noiseBuffer; hissSrc.loop = true;
      const hp = ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=900;
      const lp = ac.createBiquadFilter(); lp.type='lowpass';  lp.frequency.value=6500;
      hissSrc.connect(hp).connect(lp).connect(hissBus); hissSrc.start();
      setInterval(()=>{ if(!ac) return; const now=ac.currentTime; hissBus.gain.linearRampToValueAtTime(0.05+Math.random()*0.08, now+0.6+Math.random()*0.7); }, 1200);

      // Ring-mod grit
      const tone = ac.createOscillator(); tone.type='sine'; tone.frequency.value=340;
      const lfo  = ac.createOscillator(); lfo.type='sine';  lfo.frequency.value=28;
      const ring = ac.createGain(); ring.gain.value=0.0;
      const ringDepth = ac.createGain(); ringDepth.gain.value = 0.22;
      lfo.connect(ringDepth).connect(ring.gain);
      tone.connect(ring).connect(ringBus);
      tone.start(); lfo.start();

      // Sub boom one-shot
      function subBoom(){
        const o = ac.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(56, ac.currentTime);
        const g = ac.createGain(); g.gain.value=0.0001;
        o.connect(g).connect(subBus);
        subBus.gain.setValueAtTime(1, ac.currentTime);
        g.gain.exponentialRampToValueAtTime(0.38, ac.currentTime+0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.5);
        o.start(); o.stop(ac.currentTime+0.55);
      }
      window.__subBoom = subBoom;
    }

    function burst(vol=0.12, dur=0.08){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer;
      const g = ac.createGain(); g.gain.value = vol;
      src.connect(g).connect(clickBus);
      clickBus.gain.cancelScheduledValues(ac.currentTime);
      clickBus.gain.setValueAtTime(1, ac.currentTime);
      src.start(ac.currentTime);
      clickBus.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+dur);
    }
    function thump(){ burst(0.28, 0.12); if(window.__subBoom) window.__subBoom(); }

    function whisper({duration=1.05, cutoff=1200, q=6, gain=0.15, pan=0, trem=0.7, reverse=false}={}){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer; src.loop = true;
      const bp = ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=cutoff; bp.Q.value=q;
      const g  = ac.createGain(); g.gain.value=0.0001;
      const p  = (ac.createStereoPanner) ? ac.createStereoPanner() : null;
      if(p){ p.pan.value = pan; }
      const tremOsc = ac.createOscillator(); tremOsc.type='sine'; tremOsc.frequency.value = 6 + Math.random()*2;
      const tremGain = ac.createGain(); tremGain.gain.value = trem*gain;
      tremOsc.connect(tremGain).connect(g.gain);
      src.connect(bp); (p? bp.connect(g).connect(p).connect(whisperBus): bp.connect(g).connect(whisperBus));
      const now = ac.currentTime;
      if(reverse){ g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(gain, now + duration*0.6); g.gain.exponentialRampToValueAtTime(0.0001, now + duration); }
      else{ g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(gain, now + 0.09); g.gain.exponentialRampToValueAtTime(0.0001, now + duration); }
      bp.frequency.setValueAtTime(cutoff, now); bp.frequency.linearRampToValueAtTime(cutoff*(0.9+Math.random()*0.18), now+duration);
      src.start(now); tremOsc.start(now); src.stop(now+duration+0.05); tremOsc.stop(now+duration+0.05);
    }

    function radioSweep(){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer; src.loop = true;
      const bp = ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=250; bp.Q.value=3;
      const g  = ac.createGain(); g.gain.value=0.0001;
      src.connect(bp).connect(g).connect(radioBus);
      const now=ac.currentTime;
      radioBus.gain.cancelScheduledValues(now); radioBus.gain.setValueAtTime(1, now);
      g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.24, now+0.05); g.gain.exponentialRampToValueAtTime(0.0001, now+0.6);
      bp.frequency.linearRampToValueAtTime(6800, now+0.6);
      src.start(now); src.stop(now+0.64);
    }

    /* Clock & crackle */
    let clockCtl=null;
    function startClock(initialMs=860){
      stopClock(); let ms=initialMs;
      function tick(){ burst(0.11,0.04); tickTimer=setTimeout(tick, ms); }
      tick(); return { setRate:(n)=>{ms=Math.max(50,n);}, stop:stopClock };
    }
    function stopClock(){ if(tickTimer){ clearTimeout(tickTimer); tickTimer=null; } }
    function startCrackle(rateMs=1100){
      stopCrackle();
      function pop(){ if(Math.random()<0.82) burst(0.09+Math.random()*0.1, 0.03+Math.random()*0.06); crackleTimer=setTimeout(pop, rateMs*(0.5+Math.random()*0.9)); }
      pop();
    }
    function stopCrackle(){ if(crackleTimer){ clearTimeout(crackleTimer); crackleTimer=null; } }

    /* Typing & fast corruption (with slow final line) */
    const GLITCH=['#','%','&','/','\\','|','+','*','?','¬ß','¬£','¬¢','¬§','‚Çß'];
    function scrollToBottom(throttle=false, i=0){ if(throttle && i%5!==0) return; wrap.scrollTop = wrap.scrollHeight; }

    function typeLine(text, speed=20, glitchChance=0.18, {cueWord,onCue}={}){
      return new Promise(resolve=>{
        const line = document.createElement('div');
        const span = document.createElement('span');
        const cursor = document.createElement('span'); cursor.className='cursor';
        line.appendChild(span); line.appendChild(cursor); term.appendChild(line);

        let i=0,buf='',fired=false;
        const t = setInterval(()=>{
          if(Math.random()<glitchChance && i<text.length-1){
            span.textContent = buf + GLITCH[Math.floor(Math.random()*GLITCH.length)];
            staticFx.style.opacity='0.4'; setTimeout(()=>{staticFx.style.opacity='0';},70);
            if(Math.random()<0.25) injectGlitch(1);
          }else{
            buf += text[i]||''; span.textContent = buf; i++;
            if(cueWord && !fired && buf.includes(cueWord)){ fired=true; onCue && onCue(span); }
          }
          scrollToBottom(true,i);
          if(i>=text.length){ clearInterval(t); cursor.remove(); scrollToBottom(false); resolve({span}); }
        }, speed);
      });
    }

    function scrambleNode(node, duration=220){
      return new Promise(resolve=>{
        const text = node.textContent; let t=0, step=16;
        const charset = "01‚ñà‚ñë‚ñí‚ñì<>[]{}()|/\\#%$&*+-=~^‚Ä¢¬∑!?@Œ±Œ≤ŒûŒ©œÄ¬•‚Çø¬ß¬∂‚àû‚â°‚à¥‚àµ‚àÜ¬µ√∏√ò‚úì";
        const timer = setInterval(()=>{
          t+=step; const amt=Math.min(1, t/duration); let out=''; const cut=1-amt;
          for(let i=0;i<text.length;i++){ if(text[i]===' '){ out+=' '; continue; } out += (i/text.length < cut) ? text[i] : charset[Math.floor(Math.random()*charset.length)]; }
          node.textContent = out;
          if(amt>=1){ clearInterval(timer); resolve(); }
        }, step);
      });
    }

    /* Visual disruptors */
    function startObfuscationPulses(){
      function pulse(){ frame.classList.add('obfuscate'); setTimeout(()=>frame.classList.remove('obfuscate'), 200); }
      function schedule(){ pulse(); obfTimer=setTimeout(schedule, 520 + Math.random()*820); }
      schedule();
    }
    function dangerStrobe(){ strobe.classList.remove('flash'); void strobe.offsetWidth; strobe.classList.add('flash'); burst(0.16,0.06); frame.classList.add('tear'); setTimeout(()=>frame.classList.remove('tear'),150); }
    function noSignalFlash(){ nosig.classList.remove('show'); void nosig.offsetWidth; nosig.classList.add('show'); burst(0.25,0.1); }
    function sweepBars(){ bars.classList.add('show'); setTimeout(()=>bars.classList.remove('show'), 680); }
    function injectGlitch(level=1){
      if(level===1){ frame.classList.add('tear'); staticFx.style.opacity='0.42'; setTimeout(()=>{ frame.classList.remove('tear'); staticFx.style.opacity='0'; }, 140); }
      if(level===2){ term.classList.add('split'); dangerStrobe(); radioSweep(); setTimeout(()=>term.classList.remove('split'), 230); }
      if(level===3){ frame.classList.add('invertPop'); noSignalFlash(); setTimeout(()=>frame.classList.remove('invertPop'), 160); }
    }
    function randomLogoGlitches(){
      setInterval(()=>{
        if(Math.random()<0.38){
          logo.classList.add('glitch-burst');
          scanline.classList.remove('flash'); void scanline.offsetWidth; scanline.classList.add('flash');
          if(Math.random()<0.46){ logo.classList.add('invert'); setTimeout(()=>logo.classList.remove('invert'), 150); }
          thump();
          if(Math.random()<0.45){ whisper({duration:0.9, cutoff:1100+Math.random()*700, q:7, gain:0.09, pan:(Math.random()<0.5?-0.6:0.6), reverse:Math.random()<0.45}); }
          setTimeout(()=>logo.classList.remove('glitch-burst'), 260);
        }
      }, 1000);
    }

    /* ===== Orchestration (slow final line, instant cut) ===== */
    async function run(){
      await new Promise(r=>setTimeout(r,320));
      hissBus.gain.linearRampToValueAtTime(0.09, ac.currentTime+0.6);
      ringBus.gain.linearRampToValueAtTime(0.08, ac.currentTime+1.0);
      const clockCtl = startClock(860);
      startCrackle(1100);
      startObfuscationPulses();

      for(let idx=0; idx<lines.length; idx++){
        const isLast = (idx === lines.length - 1);
        // Normal pace for earlier lines; **much slower** for the final line
        const spd = isLast ? 60 : (idx===0 ? 88 : (idx>6 ? 62 : 75));
        const text = lines[idx];

        const cue =
          text.includes("Key") ? {cueWord:"Key", onCue:()=>{ thump(); injectGlitch(2); whisper({duration:1.1, cutoff:1350, q:8, gain:0.14, pan:-0.4, reverse:true}); }} :
          text.startsWith("REMEMBER") ? {cueWord:"REMEMBER", onCue:()=>{ thump(); injectGlitch(3); }} :
          text.startsWith("WE DO NOT") ? {cueWord:"WE DO NOT", onCue:()=>{ thump(); radioSweep(); }} :
          text.startsWith("EXPECT") ? {cueWord:"EXPECT", onCue:()=>{ thump(); dangerStrobe(); }} :
          null;

        const {span} = await typeLine(text, spd, isLast ? 0.12 : 0.18, cue || {});

        if(!isLast){
          if(span && span.textContent.trim().length>0){
            setTimeout(()=>scrambleNode(span, 220), 140);
          }
          await new Promise(r=>setTimeout(r, idx===0 ? 640 : 360));
        }else{
          // === Final line finished: immediate brutality + hard cut ===
          thump(); dangerStrobe(); sweepBars();
          // Rapid corruption of the final line itself
          await scrambleNode(span, 160);
          // Global upset
          injectGlitch(3); radioSweep(); whisper({duration:1.0, cutoff:950, q:9, gain:0.16, pan:0.6, reverse:true});
          clockCtl.setRate(140);
          // Fade text and reveal sigil fast
          wrap.style.transition='opacity 420ms ease'; wrap.style.opacity='0'; wrap.style.pointerEvents='none';
          setTimeout(()=>{ final.classList.add('show'); randomLogoGlitches(); }, 420);
          setTimeout(()=>{ clockCtl.stop(); }, 560);
        }
      }

      // Under-sigil haunt (intense)
      sigilWhisperTimer = setInterval(()=>{
        if(Math.random()<0.6) whisper({duration:0.95, cutoff:1000+Math.random()*900, q:8, gain:0.11, pan:(Math.random()<0.5?-0.6:0.6), reverse:Math.random()<0.5});
        if(Math.random()<0.5) radioSweep();
      }, 1200);
    }

    function arm(){ gate.classList.add('off'); bootAudio(); run(); }
    gate.addEventListener('pointerdown', arm, {once:true});
    gate.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') arm(); });

    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden){
        if(tickTimer) clearTimeout(tickTimer);
        if(crackleTimer) clearTimeout(crackleTimer);
        if(sigilWhisperTimer) clearInterval(sigilWhisperTimer);
        if(obfTimer) clearTimeout(obfTimer);
      }
    });
  })();
  </script>
</body>
</html>
