<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>/// TRANSMISSION ///</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{ --bg:#000; --ink:#e5ffe5; --accent:#ff2b2b; --glow:#00ff88; --cyan:#00c8ff; }
    html,body{height:100%;margin:0;background:var(--bg);font-family:"Courier New",ui-monospace,monospace;overflow:hidden;}

    /* Screen vignettes / CRT bulge */
    body::before{content:"";position:fixed;inset:-2vmax;z-index:100;pointer-events:none;
      background:radial-gradient(ellipse at center,rgba(0,0,0,0)58%,rgba(0,0,0,.48)90%,rgba(0,0,0,.94)100%);
      mix-blend-mode:multiply;filter:blur(1px);}
    body::after{content:"";position:fixed;inset:-1vmax;z-index:101;pointer-events:none;
      background:radial-gradient(100% 120% at 50% 0%,rgba(255,255,255,.045),transparent 60%),
                 radial-gradient(100% 120% at 50% 100%,rgba(255,255,255,.03),transparent 60%);
      opacity:.22;mix-blend-mode:overlay;animation:bulge 8s ease-in-out infinite;}
    @keyframes bulge{0%,100%{transform:perspective(1200px) rotateX(.6deg)}50%{transform:perspective(1200px) rotateX(-.6deg)}}

    /* Tap gate */
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;background:#000;z-index:999;color:#cfd;letter-spacing:.04em;text-align:center;transition:opacity .5s ease;}
    .gate .ring{width:120px;height:120px;border:1px dashed #0f8;border-radius:50%;display:grid;place-items:center;box-shadow:0 0 24px rgba(0,255,136,.15) inset;}
    .gate .hint{opacity:.82;font-size:clamp(1rem,3.4vw,1.2rem);text-shadow:0 0 10px rgba(0,255,136,.25);}
    .gate .mini{opacity:.6;font-size:.85rem}
    .gate.off{opacity:0;pointer-events:none}

    /* Stage */
    .frame{position:relative;height:100dvh;width:100vw;display:flex;align-items:center;justify-content:center;
      padding:6vh 6vw;box-sizing:border-box;filter:contrast(1.02) saturate(0.88);animation:subtle-flick 7s infinite, wobble 6.5s ease-in-out infinite;z-index:2;}
    .frame::before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(to bottom,rgba(255,255,255,0.03)0 1px,transparent 2px 3px);mix-blend-mode:overlay;pointer-events:none;}
    .frame::after{content:"";position:absolute;inset:-2vmax;background:radial-gradient(ellipse at center,rgba(0,0,0,.05)38%,rgba(0,0,0,.58)78%,rgba(0,0,0,.95)100%);pointer-events:none;}
    @keyframes subtle-flick{0%,92%,100%{filter:contrast(1.02)}93%{filter:contrast(1.18) brightness(1.05)}}
    @keyframes wobble{0%,100%{transform:skewX(0deg)}50%{transform:skewX(.35deg)}}

    /* Fog & glyphs */
    .fog{position:fixed;inset:-10vmax;z-index:1;pointer-events:none;opacity:.06;
      background:radial-gradient(60vmax 40vmax at 20% 30%,rgba(255,255,255,.12),transparent 70%),
                 radial-gradient(50vmax 40vmax at 80% 70%,rgba(255,255,255,.08),transparent 70%);
      filter:blur(22px);animation:fogmove 30s ease-in-out infinite;}
    @keyframes fogmove{0%{transform:translate(0,0)}50%{transform:translate(-1.6vw,1.3vh)}100%{transform:translate(0,0)}}
    .sigils{position:fixed;inset:0;pointer-events:none;z-index:2;opacity:.055;
      font:700 clamp(20px,5vw,60px)/1.1 "Courier New",monospace;color:#0f0;letter-spacing:.2em;display:flex;align-items:center;justify-content:center;mix-blend-mode:screen;filter:blur(.75px);}
    .sigils span{opacity:.08;animation:sigil 14s ease-in-out infinite;}
    @keyframes sigil{0%,100%{transform:scale(1) rotate(0deg)}50%{transform:scale(1.03) rotate(.6deg)}}

    /* Scroll-follow container */
    .termwrap{position:relative;width:100%;max-width:56rem;max-height:calc(100dvh - 12vh);overflow:auto;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;padding-right:4px;z-index:3;}
    .termwrap::-webkit-scrollbar{width:0;height:0}

    /* Terminal text */
    .terminal{position:relative;color:var(--ink);
      text-shadow:0 0 .75px var(--ink),0 0 8px rgba(0,255,0,.14),1px 0 0 rgba(255,0,0,.1),-1px 0 0 rgba(0,150,255,.1);
      line-height:1.45;font-size:clamp(.9rem,2.7vw,1.1rem);letter-spacing:.02em;transform:translateZ(0);
      opacity:0;animation:power-on 700ms ease-out forwards 400ms;filter:brightness(1.03) contrast(1.05);}
    .terminal.heartbeat{animation:power-on 700ms ease-out forwards 400ms,heartbeat 2.6s ease-in-out 2 1.2s;}
    .terminal.ghost{text-shadow:0 0 1px rgba(229,255,229,.28),2px 0 6px rgba(0,255,128,.14),-2px 0 6px rgba(0,200,255,.14);filter:brightness(1.05) contrast(1.07);}
    .terminal.split{filter:contrast(1.12) saturate(1.08) drop-shadow(1px 0 0 rgba(255,0,0,.26)) drop-shadow(-1px 0 0 rgba(0,200,255,.26));}
    @keyframes power-on{from{opacity:0;filter:blur(3px)}to{opacity:1;filter:none}}
    @keyframes heartbeat{0%{transform:scale(1)}14%{transform:scale(1.02)}28%{transform:scale(1)}42%{transform:scale(1.015)}70%{transform:scale(1)}100%{transform:scale(1)}}
    .final-thump{animation:quickPulse .5s ease-in-out 1;}
    @keyframes quickPulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

    /* Static / artifacts */
    .static{position:fixed;inset:0;pointer-events:none;opacity:0;mix-blend-mode:screen;filter:blur(.5px);
      background-image:
        radial-gradient(1px 1px at 10% 20%,#0f0 60%,transparent 61%),
        radial-gradient(1px 1px at 70% 80%,#0f0 60%,transparent 61%),
        radial-gradient(1px 1px at 30% 60%,#0f0 60%,transparent 61%);
      animation:noise-pop 3.4s infinite;z-index:4;}
    @keyframes noise-pop{0%{opacity:0}6%{opacity:.38}8%{opacity:0}60%{opacity:.17}62%{opacity:0}100%{opacity:0}}

    .dead{position:fixed;inset:0;pointer-events:none;z-index:5;opacity:.14;background:
      radial-gradient(1px 1px at 12% 22%,#fff,transparent 60%),
      radial-gradient(1px 1px at 62% 72%,#fff,transparent 60%),
      radial-gradient(1px 1px at 42% 82%,#fff,transparent 60%),
      radial-gradient(1px 1px at 78% 18%,#fff,transparent 60%);mix-blend-mode:screen;animation:deadblink 2.6s steps(2,end) infinite;}
    @keyframes deadblink{0%{opacity:.14}50%{opacity:.03}100%{opacity:.14}}

    .strobe{position:fixed;inset:0;pointer-events:none;opacity:0;background:radial-gradient(ellipse at center,rgba(255,0,0,.36),rgba(255,0,0,0)70%);mix-blend-mode:screen;z-index:7;}
    .strobe.flash{animation:strobe 200ms ease-out 1;}
    @keyframes strobe{0%{opacity:0}10%{opacity:1}100%{opacity:0}}

    .nosignal{position:fixed;inset:0;pointer-events:none;opacity:0;z-index:8;
      background:conic-gradient(from 0deg at 50% 50%,rgba(255,0,0,.09),rgba(0,255,0,.09),rgba(0,0,255,.09),rgba(255,0,0,.09));
      mix-blend-mode:screen;}
    .nosignal.show{animation:nosig 420ms ease-out 1;}
    @keyframes nosig{0%{opacity:0}10%{opacity:.8;transform:skewX(1.2deg)}80%{opacity:.22}100%{opacity:0}}

    .bars{position:fixed;inset:0;pointer-events:none;z-index:6;opacity:0;background:repeating-linear-gradient(to bottom,rgba(0,255,160,.12) 0 2px,rgba(0,0,0,0) 2px 6px);}
    .bars.show{animation:bars-sweep 760ms ease-out forwards;}
    @keyframes bars-sweep{0%{opacity:0;transform:translateY(-6%)}15%{opacity:.98}100%{opacity:0;transform:translateY(6%)}}

    /* Extra glitch moves */
    .tear{animation:tear 160ms steps(2,end) 1;}
    @keyframes tear{0%{transform:skewX(0deg) translateX(0)}50%{transform:skewX(2.2deg) translateX(2.2px)}100%{transform:skewX(0deg) translateX(0)}}
    .invertPop{filter:invert(1) hue-rotate(180deg) contrast(1.28) brightness(1.12);}

    /* After-image ghosting (applied to recent lines) */
    .after .ghost1,.after .ghost2{position:absolute;left:0;right:0;top:0;pointer-events:none}
    .after .ghost1{opacity:.10;filter:blur(.6px);transform:translate(1px,1px);color:#9affc9;text-shadow:0 0 8px rgba(0,255,136,.25);}
    .after .ghost2{opacity:.10;filter:blur(.6px);transform:translate(-1px,-1px);color:#ff7a7a;text-shadow:0 0 8px rgba(255,60,60,.25);}

    /* Final sigil */
    .final{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:9;transition:opacity 700ms ease;}
    .final.show{opacity:1;}
    .logo{position:relative;width:min(42vw,360px);aspect-ratio:1/1;filter:drop-shadow(0 0 18px rgba(0,255,136,.55)) brightness(1.02);animation:sway 7.5s ease-in-out infinite;}
    @keyframes sway{0%,100%{transform:rotate(-1.6deg)}50%{transform:rotate(1.6deg)}}
    .invert{filter:invert(1) hue-rotate(180deg) contrast(1.25)!important;}
    .layer{position:absolute;inset:0;}
    .layer.r{mix-blend-mode:screen;filter:hue-rotate(340deg) drop-shadow(0 0 8px rgba(255,60,60,.4));transform:translate(-1px,0);opacity:.9;}
    .layer.g{mix-blend-mode:screen;filter:hue-rotate(120deg) drop-shadow(0 0 16px rgba(0,255,136,.65));transform:translate(0,0);opacity:1;}
    .layer.b{mix-blend-mode:screen;filter:hue-rotate(210deg) drop-shadow(0 0 8px rgba(0,140,255,.4));transform:translate(1px,0);opacity:.9;}
    .glitch-soft{animation:glitchShift 2.1s ease-in-out infinite;}
    .glitch-burst{animation:glitchBurst 280ms steps(2,end) 1;}
    @keyframes glitchShift{0%{transform:translate(0,0)}8%{transform:translate(-1px,0)}16%{transform:translate(1px,0)}24%{transform:translate(0,.5px)}32%{transform:translate(0,-.5px)}100%{transform:translate(0,0)}}
    @keyframes glitchBurst{0%{transform:translate(0,0) skewX(0deg);opacity:1}50%{transform:translate(-2px,0) skewX(-2deg);opacity:.86}100%{transform:translate(2px,0) skewX(2deg);opacity:1}}
    .scanline{position:absolute;left:0;right:0;height:2px;top:50%;background:rgba(255,255,255,.92);box-shadow:0 0 10px rgba(255,255,255,.85),0 0 20px rgba(180,180,180,.65);opacity:0;transform:translateY(-50%) scaleY(0.02);pointer-events:none;}
    .scanline.flash{animation:tv-line-flash 420ms ease-out 1;}
    @keyframes tv-line-flash{0%{opacity:0;transform:translateY(-50%) scaleY(0.02)}15%{opacity:1;transform:translateY(-50%) scaleY(1)}70%{opacity:1;transform:translateY(-50%) scaleY(0.03)}100%{opacity:0;transform:translateY(-50%) scaleY(0)}}

    /* Michigan-style echo utility kept for emphasis reuse */
    .echo{position:relative;display:block;}
    .echo::before,.echo::after{content:attr(data-text);position:absolute;left:0;right:0;top:0;opacity:.18;filter:blur(.6px);transform:translate(1px,1px);color:#9affc9;text-shadow:0 0 8px rgba(0,255,136,.25);pointer-events:none;animation:echoFade .7s ease-out forwards;}
    .echo::after{color:#ff7a7a;transform:translate(-1px,-1px);text-shadow:0 0 8px rgba(255,60,60,.25);animation-delay:.06s;}
    @keyframes echoFade{0%{opacity:.22}100%{opacity:0}}

    .cursor{display:inline-block;width:.65ch;margin-left:.1ch;background:currentColor;animation:blink 1s steps(1,end) infinite;vertical-align:-2px;}
    @keyframes blink{50%{opacity:0}}
    .jolt{animation:jolt 120ms ease-in-out;}
    @keyframes jolt{0%{transform:translate(0,0)}40%{transform:translate(1.2px,-1.2px)}80%{transform:translate(-1.2px,1.2px)}100%{transform:translate(0,0)}}
  </style>
</head>
<body>
  <!-- Tap to enable audio -->
  <div class="gate" id="gate" role="button" tabindex="0" aria-label="Tap to begin">
    <div class="ring"><span class="hint">TAP TO BEGIN</span></div>
    <div class="mini">Enable sound for full effect.</div>
  </div>

  <div class="fog"></div>
  <div class="sigils"><span>☉ ☿ ♀ ♁ ♂ ♃ ♄ ♅ ♆ ♇ ✠ ✶ ✷ ✴ ✧ ✟</span></div>
  <div class="dead"></div>

  <div class="frame" id="frame">
    <div class="termwrap" id="termwrap">
      <div class="terminal" id="term" aria-live="polite"></div>
    </div>
    <div class="static" id="static"></div>
  </div>

  <div class="strobe" id="strobe"></div>
  <div class="nosignal" id="nosig"></div>
  <div class="bars" id="bars"></div>

  <!-- Final sigil -->
  <div class="final" id="final">
    <div class="logo glitch-soft" id="logo">
      <div class="layer r">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#ff4d4d">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="layer g">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#00ff88">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="layer b">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" color="#00c8ff">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="scanline" id="scanline"></div>
    </div>
  </div>

  <script>
  (() => {
    /* ===== Copy (EN, corrected) ===== */
    const lines = [
      "Look, I know I am the type to mention lawsuits and have you in court.",
      "However, I would much rather, live a peaceful lifestyle.",
      "",
      "This device, is a collaborative project, and is one of my own.",
      "However, it will only keep on infecting; The skin, needs to be able to heal fully, over the foreign body.",
      "",
      "The exposed tip, is causing, CONTINUAL INFECTION...",
      "BASICALLY, I NEED YOU TO LISTEN, AS IT DOESN'T GET REMOVED.",
      "You will only damage all of my hands nerve endings in doing so.",
      "So please just help me.",
      "I just, need someone to stitch, or find a way to let the skin heal over.",
      "Otherwise, I'll have to live, on antibiotics.",
      "And come on, that isn't even realistic.",
      "PLEASE HELP ME, I don't even care how much pain I have to go through, I just need this device, to be under, the skin, FULLY.",
      "",
      "I NEVER, break or destroy a promise.",
      "But I promise you, I need this chip, more than you'll know, and/or even understand.",
      "",
      "So please, just help me.",
      "That's all I ask."
    ];

    /* ===== DOM ===== */
    const gate   = document.getElementById('gate');
    const frame  = document.getElementById('frame');
    const wrap   = document.getElementById('termwrap');
    const term   = document.getElementById('term');
    const staticFx = document.getElementById('static');
    const strobe = document.getElementById('strobe');
    const bars   = document.getElementById('bars');
    const final  = document.getElementById('final');
    const logo   = document.getElementById('logo');
    const scanline = document.getElementById('scanline');
    const nosig  = document.getElementById('nosig');

    /* ===== Audio: expanded dread ===== */
    let ac, master, humGain, clickBus, whisperBus, hissBus, radioBus, ringBus, subBus;
    let noiseBuffer=null, tickTimer=null, crackleTimer=null, sigilWhisperTimer=null;

    function bootAudio(){
      if(ac) return;
      ac = new (window.AudioContext || window.webkitAudioContext)();
      master = ac.createGain(); master.gain.value = 0.62; master.connect(ac.destination);

      // Low binaural hum with slow trem
      const o1 = ac.createOscillator(); o1.type='sine'; o1.frequency.value=54;
      const o2 = ac.createOscillator(); o2.type='sine'; o2.frequency.value=60.5;
      const trem = ac.createOscillator(); trem.type='sine'; trem.frequency.value=0.22;
      humGain = ac.createGain(); humGain.gain.value=0.065;
      const tremDepth = ac.createGain(); tremDepth.gain.value=0.05;
      trem.connect(tremDepth).connect(humGain.gain);
      o1.connect(humGain); o2.connect(humGain); humGain.connect(master);
      o1.start(); o2.start(); trem.start();

      // Buses
      clickBus   = ac.createGain(); clickBus.gain.value=0; clickBus.connect(master);      // ticks & pops
      whisperBus = ac.createGain(); whisperBus.gain.value=0.7; whisperBus.connect(master); // whispers
      hissBus    = ac.createGain(); hissBus.gain.value=0.0; hissBus.connect(master);       // tape hiss bed
      radioBus   = ac.createGain(); radioBus.gain.value=0.0; radioBus.connect(master);     // sweep
      ringBus    = ac.createGain(); ringBus.gain.value=0.0; ringBus.connect(master);       // ring-mod grit
      subBus     = ac.createGain(); subBus.gain.value=0.0; subBus.connect(master);         // sub booms

      // White noise buffer (for hiss/whispers/clicks)
      noiseBuffer = ac.createBuffer(1, ac.sampleRate * 1.0, ac.sampleRate);
      const d = noiseBuffer.getChannelData(0);
      for(let i=0;i<d.length;i++){ d[i] = Math.random()*2-1; }

      // Tape hiss loop (band-limited, slow wander)
      const hissSrc = ac.createBufferSource(); hissSrc.buffer = noiseBuffer; hissSrc.loop = true;
      const hp = ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200;
      const lp = ac.createBiquadFilter(); lp.type='lowpass';  lp.frequency.value=7000;
      hissSrc.connect(hp).connect(lp).connect(hissBus); hissSrc.start();
      setInterval(()=>{ if(!ac) return; const now=ac.currentTime; hissBus.gain.linearRampToValueAtTime(0.02+Math.random()*0.06, now+0.7+Math.random()*0.7); }, 1500);

      // Ring-mod texture (AM on mid tone, faint)
      const tone = ac.createOscillator(); tone.type='sine'; tone.frequency.value=380;
      const lfo  = ac.createOscillator(); lfo.type='sine';  lfo.frequency.value=27;
      const ring = ac.createGain(); ring.gain.value=0.0;
      const ringDepth = ac.createGain(); ringDepth.gain.value = 0.18; // depth of AM
      lfo.connect(ringDepth).connect(ring.gain);
      tone.connect(ring).connect(ringBus);
      tone.start(); lfo.start();

      // Sub boom generator (short decays on command)
      function subBoom(){
        const o = ac.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(60, ac.currentTime);
        const g = ac.createGain(); g.gain.value=0.0001;
        o.connect(g).connect(subBus);
        subBus.gain.setValueAtTime(1, ac.currentTime);
        g.gain.exponentialRampToValueAtTime(0.35, ac.currentTime+0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.5);
        o.start(); o.stop(ac.currentTime+0.55);
      }
      window.__subBoom = subBoom; // expose for cues
    }

    /* One-shot noise burst for ticks/pops */
    function burst(vol=0.12, dur=0.08){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer;
      const g = ac.createGain(); g.gain.value = vol;
      src.connect(g).connect(clickBus);
      clickBus.gain.cancelScheduledValues(ac.currentTime);
      clickBus.gain.setValueAtTime(1, ac.currentTime);
      src.start(ac.currentTime);
      clickBus.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+dur);
    }
    function thump(){ burst(0.25, 0.12); if(window.__subBoom) window.__subBoom(); }

    /* Whisper (band-pass noise) with trem & stereo drift; supports reverse-style swell */
    function whisper({duration=1.2, cutoff=1200, q=6, gain=0.12, pan=0, trem=0.7, reverse=false}={}){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer; src.loop = true;
      const bp = ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=cutoff; bp.Q.value=q;
      const g  = ac.createGain(); g.gain.value=0.0001;
      const p  = (ac.createStereoPanner) ? ac.createStereoPanner() : null;
      if(p){ p.pan.value = pan; }
      const tremOsc = ac.createOscillator(); tremOsc.type='sine'; tremOsc.frequency.value = 6 + Math.random()*2;
      const tremGain = ac.createGain(); tremGain.gain.value = trem*gain;
      tremOsc.connect(tremGain).connect(g.gain);
      src.connect(bp);
      if(p){ bp.connect(g).connect(p).connect(whisperBus); } else { bp.connect(g).connect(whisperBus); }
      const now = ac.currentTime;
      if(reverse){
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(gain, now + duration*0.65);   // swell up first
        g.gain.exponentialRampToValueAtTime(0.0001, now + duration);      // then vanish
      }else{
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(gain, now + 0.12);
        g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
      }
      bp.frequency.setValueAtTime(cutoff, now);
      bp.frequency.linearRampToValueAtTime(cutoff * (0.92 + Math.random()*0.16), now+duration);
      src.start(now); tremOsc.start(now);
      src.stop(now + duration + 0.05); tremOsc.stop(now + duration + 0.05);
    }

    /* Radio sweep */
    function radioSweep(){
      if(!ac) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer; src.loop = true;
      const bp = ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=250; bp.Q.value=3;
      const g  = ac.createGain(); g.gain.value=0.0001;
      src.connect(bp).connect(g).connect(radioBus);
      const now=ac.currentTime;
      radioBus.gain.cancelScheduledValues(now);
      radioBus.gain.setValueAtTime(1, now);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.2, now+0.06);
      g.gain.exponentialRampToValueAtTime(0.0001, now+0.7);
      bp.frequency.linearRampToValueAtTime(6500, now+0.7);
      src.start(now); src.stop(now+0.74);
    }

    /* Clock tick (accelerates under tension) */
    let clockCtl=null;
    function startClock(initialMs=900){
      stopClock(); let ms=initialMs;
      function tick(){ burst(0.09,0.04); tickTimer=setTimeout(tick, ms); }
      tick();
      return { setRate:(n)=>{ms=Math.max(55,n);}, stop:stopClock };
    }
    function stopClock(){ if(tickTimer){ clearTimeout(tickTimer); tickTimer=null; } }

    /* Random crackle pops */
    function startCrackle(rateMs=1300){
      stopCrackle();
      function pop(){ if(Math.random()<0.78) burst(0.07+Math.random()*0.1, 0.03+Math.random()*0.06); crackleTimer=setTimeout(pop, rateMs*(0.55+Math.random()*0.95)); }
      pop();
    }
    function stopCrackle(){ if(crackleTimer){ clearTimeout(crackleTimer); crackleTimer=null; } }

    /* ===== Typing / visual corruption ===== */
    const GLITCH=['#','%','&','/','\\','|','+','*','?','§','£','¢','¤','₧'];
    function scrollToBottom(throttle=false, i=0){ if(throttle && i%6!==0) return; wrap.scrollTop = wrap.scrollHeight; }

    function typeLine(text, speed=22, glitchChance=0.11, {cueWord,onCue}={}){
      return new Promise(resolve=>{
        const line = document.createElement('div');
        const span = document.createElement('span');
        const cursor = document.createElement('span'); cursor.className='cursor';
        line.appendChild(span); line.appendChild(cursor); term.appendChild(line);

        // after-image wrapper
        const holder = document.createElement('div'); holder.className='after'; holder.style.position='relative';
        line.replaceWith(holder); holder.appendChild(line);

        let i=0,buf='',fired=false;
        const t = setInterval(()=>{
          if(Math.random()<glitchChance && i<text.length-1){
            span.textContent = buf + GLITCH[Math.floor(Math.random()*GLITCH.length)];
            staticFx.style.opacity='0.32'; setTimeout(()=>{staticFx.style.opacity='0';},70);
            if(Math.random()<0.18) injectGlitch(1);
          }else{
            buf += text[i]||''; span.textContent = buf; i++;
            if(cueWord && !fired && buf.includes(cueWord)){ fired=true; onCue && onCue(span); }
          }
          scrollToBottom(true,i);
          if(i>=text.length){
            clearInterval(t); cursor.remove(); scrollToBottom(false);
            // spawn fading ghosts to leave a trail
            const g1=document.createElement('div'); g1.className='ghost1'; g1.textContent=span.textContent;
            const g2=document.createElement('div'); g2.className='ghost2'; g2.textContent=span.textContent;
            holder.appendChild(g1); holder.appendChild(g2);
            setTimeout(()=>{ g1.remove(); g2.remove(); }, 900);
            resolve({holder,span});
          }
        }, speed);
      });
    }

    function randomJolts(){ setInterval(()=>{ if(Math.random()<0.24){ frame.classList.add('jolt'); term.classList.toggle('ghost'); setTimeout(()=>{frame.classList.remove('jolt');term.classList.toggle('ghost');},160);} },1100); }
    function dangerStrobe(){ strobe.classList.remove('flash'); void strobe.offsetWidth; strobe.classList.add('flash'); burst(0.13,0.06); frame.classList.add('jolt'); setTimeout(()=>frame.classList.remove('jolt'),160); }
    function noSignalFlash(){ nosig.classList.remove('show'); void nosig.offsetWidth; nosig.classList.add('show'); burst(0.2,0.1); }

    function scrambleNode(node, duration=420){
      return new Promise(resolve=>{
        const text = node.textContent; let t=0, step=22;
        const charset = "01█░▒▓<>[]{}()|/\\#%$&*+-=~^•·!?@αβΞΩπ¥₿§¶∞≡∴∵∆µøØ✓";
        const timer = setInterval(()=>{
          t+=step; const amt=Math.min(1, t/duration); let out=''; const cut=1-amt;
          for(let i=0;i<text.length;i++){ if(text[i]===' '){ out+=' '; continue; } out += (i/text.length < cut) ? text[i] : charset[Math.floor(Math.random()*charset.length)]; }
          node.textContent = out;
          if(amt>=1){ clearInterval(timer); resolve(); }
        }, step);
      });
    }
    function sweepBars(){ bars.classList.add('show'); setTimeout(()=>bars.classList.remove('show'), 760); }

    function randomLogoGlitches(){
      setInterval(()=>{
        if(Math.random()<0.34){
          logo.classList.add('glitch-burst');
          scanline.classList.remove('flash'); void scanline.offsetWidth; scanline.classList.add('flash');
          if(Math.random()<0.42){ logo.classList.add('invert'); setTimeout(()=>logo.classList.remove('invert'), 170); }
          thump();
          // faint whispers beneath sigil
          if(Math.random()<0.4){ whisper({duration:0.95, cutoff:1000+Math.random()*600, q:7, gain:0.08, pan:(Math.random()<0.5?-0.6:0.6), reverse:Math.random()<0.4}); }
          setTimeout(()=>logo.classList.remove('glitch-burst'), 300);
        }
      }, 1200);
    }

    function applyEcho(spanEl){ const parent = spanEl.parentElement; parent.classList.add('echo'); parent.setAttribute('data-text', spanEl.textContent); }

    function injectGlitch(level=1){
      if(level===1){ frame.classList.add('tear'); staticFx.style.opacity='0.36'; setTimeout(()=>{ frame.classList.remove('tear'); staticFx.style.opacity='0'; }, 150); }
      if(level===2){ term.classList.add('split'); dangerStrobe(); radioSweep(); setTimeout(()=>term.classList.remove('split'), 260); }
      if(level===3){ frame.classList.add('invertPop'); noSignalFlash(); setTimeout(()=>frame.classList.remove('invertPop'), 180); }
    }

    /* ===== Orchestration ===== */
    async function run(){
      await new Promise(r=>setTimeout(r,420));
      // bring beds up
      hissBus.gain.linearRampToValueAtTime(0.035, ac.currentTime+0.6);
      ringBus.gain.linearRampToValueAtTime(0.07, ac.currentTime+1.0);
      const clockCtl = startClock(900);
      startCrackle(1300);

      // Typing (15% slower baseline): 98 / 82 / 68; pauses 731 / 423
      for(let idx=0; idx<lines.length; idx++){
        const spd = idx===0 ? 98 : (idx>4 ? 68 : 82);
        const isPlea = lines[idx].includes("PLEASE HELP ME");
        const isInfection = lines[idx].includes("CONTINUAL INFECTION");
        const {span} = await typeLine(
          lines[idx], spd, 0.11,
          isPlea
            ? {cueWord:"PLEASE HELP ME", onCue:()=>{ dangerStrobe(); thump(); whisper({duration:1.5, cutoff:1350, q:8, gain:0.1, pan:-0.55, reverse:true}); injectGlitch(2);} }
            : (isInfection
                ? {cueWord:"CONTINUAL INFECTION", onCue:()=>{ applyEcho(span); injectGlitch(3); whisper({duration:1.2, cutoff:1150, q:7, gain:0.09, pan:.5}); }}
                : {})
        );

        if(lines[idx].startsWith("Look, I know I am the type")) injectGlitch(1);
        if(lines[idx].startsWith("This device")) { injectGlitch(1); radioSweep(); }
        if(lines[idx].startsWith("BASICALLY, I NEED YOU TO LISTEN")) injectGlitch(2);
        if(lines[idx].startsWith("I NEVER")) { injectGlitch(2); whisper({duration:1.0, cutoff:900, q:9, gain:0.08, pan:(Math.random()<0.5?-0.7:0.7), reverse:true}); }

        await new Promise(r=>setTimeout(r, idx===0 ? 731 : 423));
      }

      randomJolts();
      term.classList.add('heartbeat');

      // Suspense & ramp
      await new Promise(r=>setTimeout(r, 1700));
      term.classList.add('final-thump'); thump();
      clockCtl.setRate(400);
      whisper({duration:1.7, cutoff:880, q:9, gain:0.11, pan:(Math.random()<0.5?-0.75:0.75), reverse:true});
      radioSweep(); injectGlitch(2);

      // Chroma split + no-signal + extra upset
      term.classList.add('split'); noSignalFlash(); burst(0.16,0.1);

      // Phase 1: fast scramble lines; tighten tick
      clockCtl.setRate(280);
      const nodes = Array.from(term.querySelectorAll('div > span:first-child'));
      for(const n of nodes){ await scrambleNode(n, 420); if(Math.random()<0.55) injectGlitch(1); }

      // Phase 2: bars + strobe + global scramble; frantic tick
      sweepBars(); dangerStrobe(); clockCtl.setRate(150);
      await Promise.all(nodes.map(n => scrambleNode(n, 300)));
      injectGlitch(3);

      // Fade to sigil; keep low hiss/ring, stop clock
      wrap.style.transition='opacity 640ms ease'; wrap.style.opacity='0'; wrap.style.pointerEvents='none';
      setTimeout(()=>{ final.classList.add('show'); randomLogoGlitches(); }, 650);
      setTimeout(()=>{ clockCtl.stop(); }, 700);

      // Under-sigil haunt
      sigilWhisperTimer = setInterval(()=>{
        if(Math.random()<0.55) whisper({duration:0.95, cutoff:1200+Math.random()*700, q:7, gain:0.075, pan:(Math.random()<0.5?-0.6:0.6), reverse:Math.random()<0.45});
        if(Math.random()<0.4) radioSweep();
      }, 1500);
    }

    function arm(){ gate.classList.add('off'); bootAudio(); run(); }
    gate.addEventListener('pointerdown', arm, {once:true});
    gate.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') arm(); });

    // Safety: stop timers when hidden
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden){ if(tickTimer) clearTimeout(tickTimer); if(crackleTimer) clearTimeout(crackleTimer); if(sigilWhisperTimer) clearInterval(sigilWhisperTimer); }
    });
  })();
  </script>
</body>
</html>
