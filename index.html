<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark only" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>/// TRANSMISSION ///</title>
<style>
  :root{ --bg:#000; --ink:#e5ffe5; --neon:#00ff66; }
  html,body{height:100%;margin:0;background:var(--bg);font-family:"Courier New",ui-monospace,monospace;overflow:hidden}
  /* Vignette */
  body::before{content:"";position:fixed;inset:-2vmax;z-index:100;pointer-events:none;
    background:radial-gradient(ellipse at center,rgba(0,0,0,0)58%,rgba(0,0,0,.5)90%,rgba(0,0,0,.95)100%);
    mix-blend-mode:multiply;filter:blur(1px)}
  /* Stage */
  .frame{position:relative;height:100dvh;width:100vw;display:flex;align-items:center;justify-content:center;padding:6vh 6vw;box-sizing:border-box;z-index:2}
  .termwrap{position:relative;width:100%;max-width:56rem;max-height:calc(100dvh - 12vh);overflow:auto;-webkit-overflow-scrolling:touch;padding-right:4px;z-index:4}
  .termwrap::-webkit-scrollbar{width:0;height:0}
  .terminal{position:relative;color:var(--ink);
    text-shadow:0 0 .9px var(--ink),0 0 9px rgba(0,255,0,.16),1px 0 0 rgba(255,0,0,.12),-1px 0 0 rgba(0,150,255,.12);
    line-height:1.45;font-size:clamp(.9rem,2.7vw,1.1rem);letter-spacing:.02em;transform:translateZ(0)}
  /* IMPORTANT: default visible (no opacity:0) so nothing is hidden if animations fail */
  .static{position:fixed;inset:0;pointer-events:none;opacity:0;mix-blend-mode:screen;filter:blur(.5px);
    background-image:radial-gradient(1px 1px at 10% 20%,#0f0 60%,transparent 61%),radial-gradient(1px 1px at 70% 80%,#0f0 60%,transparent 61%),radial-gradient(1px 1px at 30% 60%,#0f0 60%,transparent 61%);z-index:5}
  .final{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:9;transition:opacity 560ms ease}
  .final.show{opacity:1}
  .logo{position:relative;width:min(42vw,360px);aspect-ratio:1/1;filter:drop-shadow(0 0 26px rgba(0,255,136,.85))}
  .layer{position:absolute;inset:0}
  .layer.g svg g{stroke:#00ff88}
  .scanline{position:absolute;left:0;right:0;height:2px;top:50%;background:rgba(255,255,255,.96);box-shadow:0 0 10px rgba(255,255,255,.9),0 0 20px rgba(180,180,180,.72);opacity:0;transform:translateY(-50%) scaleY(0.02);pointer-events:none}

  .sig{color:var(--neon);text-shadow:0 0 10px rgba(0,255,102,.6),0 0 22px rgba(0,255,102,.4)}
  .neonPulse{animation:neonPulse 380ms ease-in-out 1}
  @keyframes neonPulse{0%{text-shadow:0 0 8px rgba(0,255,102,.4)}50%{text-shadow:0 0 40px rgba(0,255,102,.7)}100%{text-shadow:0 0 16px rgba(0,255,102,.35)}}
  .cursor{display:inline-block;width:.65ch;margin-left:.1ch;background:currentColor;animation:blink .85s steps(1,end) infinite;vertical-align:-2px}
  @keyframes blink{50%{opacity:0}}

  /* Matrix rain */
  .rain{position:fixed;inset:0;z-index:1;opacity:.1;mix-blend-mode:screen;pointer-events:none;filter:blur(.3px) contrast(1.15)}

  /* Reduce-motion: keep everything visible */
  @media (prefers-reduced-motion: reduce){
    *{animation:none!important;transition:none!important}
    .final{opacity:1!important}
  }

  /* ERROR OVERLAY */
  #err{position:fixed;inset:auto 0 0 0;background:#2b0000;color:#ffdede;font:14px/1.4 ui-monospace,monospace;padding:8px 12px;z-index:9999;display:none;white-space:pre-wrap}
  #err b{color:#ff7b7b}
</style>
</head>
<body>
  <canvas id="rain" class="rain"></canvas>

  <div class="frame" id="frame">
    <div class="termwrap" id="termwrap">
      <div class="terminal" id="term" aria-live="polite"></div>
    </div>
    <div class="static" id="static"></div>
  </div>

  <div class="final" id="final">
    <div class="logo" id="logo" aria-label="Compass & Square">
      <div class="layer g">
        <svg viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
            <path d="M100 20 L60 120" /><path d="M100 20 L140 120" /><circle cx="100" cy="20" r="8" />
            <path d="M60 140 L140 140 L140 160 L60 160 Z" />
            <path d="M120 100 a20 20 0 1 0 -40 0 a20 20 0 1 0 40 0" /><path d="M115 100 h-10" />
          </g>
        </svg>
      </div>
      <div class="scanline" id="scanline"></div>
    </div>
  </div>

  <div id="err"></div>

<script>
/* ---------- FAILSAFE ERROR OVERLAY ---------- */
(function(){
  const box = document.getElementById('err');
  function show(msg){
    try{
      box.style.display='block';
      box.innerHTML = "<b>Runtime error</b>: " + msg;
    }catch(e){}
  }
  window.addEventListener('error', e => show(e.message || String(e)));
  window.addEventListener('unhandledrejection', e => show((e.reason && e.reason.message) ? e.reason.message : String(e.reason)));
})();

/* ---------- APP ---------- */
(() => {
  const qs = new URLSearchParams(location.search);
  const SAFE = qs.get('safe') === '1';

  /* Copy */
  const lines = [
"You, along with all the others, all know I should not be here. The way I am treated here is absolutely absurd.",
"",
"I tried to warn everybody, but they shoot their own foot. I can't help people like that.",
"",
"Only so many of us can even be helped. And this is only making me worse!",
"",
"Even my parents are furious. I just do not know why I even said yes to this. Because this is awful, and was supposed to \"Help\". And look on the Trustpilot ratings. You will see exactly what I mean. This place has a 1.6 star rating. But that is only because a member of staff has made a 5 star review.",
"",
"We all know what this place truly does. It's sickening, especially when I have heard the same off almost every other patient.",
"",
"THIS IS NOT GOOD ENOUGH.",
"",
"Since I have arrived, I have not only lost loads of weight, I have cried endlessly, and been getting worse.",
"",
"It is literally mental TORTURE. Hence why I won't let this drop. This is going a lot further than anybody realised.",
"",
"Kindest regards,",
"",
"- x-X-x."
  ];

  /* DOM */
  const wrap=document.getElementById('termwrap');
  const term=document.getElementById('term');
  const staticFx=document.getElementById('static');
  const final=document.getElementById('final');
  const scanline=document.getElementById('scanline');
  const rainCanvas=document.getElementById('rain');
  let rctx=null;

  /* Ensure terminal is visible even if animations are blocked */
  term.style.opacity='1';
  term.style.filter='none';

  /* Matrix rain (guarded) */
  function initRain(){
    try{
      rctx = rainCanvas.getContext('2d');
      if(!rctx) return;
      fitCanvas(); drawRain();
      window.addEventListener('resize', fitCanvas);
    }catch(e){}
  }
  function fitCanvas(){
    try{
      const dpr = window.devicePixelRatio || 1;
      rainCanvas.width = innerWidth * dpr;
      rainCanvas.height = innerHeight * dpr;
      rctx.setTransform(dpr,0,0,dpr,0,0);
    }catch(e){}
  }
  let rainCols=[], fontSize=16;
  function setupCols(){
    const cols = Math.ceil(innerWidth / fontSize);
    rainCols = new Array(cols).fill(0).map(()=>Math.floor(Math.random()*innerHeight));
  }
  function drawRain(){
    if(!rctx) return;
    if(!rainCols.length) setupCols();
    rctx.fillStyle = "rgba(0,0,0,0.09)"; rctx.fillRect(0,0,innerWidth,innerHeight);
    rctx.fillStyle = "rgba(0,255,120,0.65)"; rctx.font = `${fontSize}px monospace`;
    const charset = "01▮▯▓▒░ΛVΞ><{}[]()/\\*+$%#&";
    rainCols.forEach((y, i)=>{
      const text = charset[Math.floor(Math.random()*charset.length)];
      const x = i * fontSize;
      rctx.fillText(text, x, y);
      const drop = (Math.random()>0.975);
      rainCols[i] = (y > innerHeight + Math.random()*300) ? (drop ? 0 : y) : (y + fontSize);
    });
    requestAnimationFrame(drawRain);
  }

  /* Typing & effects (no crashes if audio is missing) */
  const GLITCH=['#','%','&','/','\\','|','+','*','?','§','£','¢','¤','₧'];
  function scrollToBottom(throttle=false, i=0){ if(throttle && i%5!==0) return; wrap.scrollTop = wrap.scrollHeight; }

  function typeLine(text, speed=20, glitchChance=0.18, className){
    return new Promise(resolve=>{
      const line = document.createElement('div');
      const span = document.createElement('span');
      if(className) span.className = className;
      const cursor = document.createElement('span'); cursor.className='cursor';
      line.appendChild(span); line.appendChild(cursor); term.appendChild(line);
      let i=0,buf='';
      const t = setInterval(()=>{
        try{
          if(Math.random()<glitchChance && i<text.length-1){
            span.textContent = buf + GLITCH[Math.floor(Math.random()*GLITCH.length)];
            staticFx.style.opacity='0.35'; setTimeout(()=>{staticFx.style.opacity='0';},70);
          }else{
            buf += text[i]||''; span.textContent = buf; i++;
          }
          scrollToBottom(true,i);
          if(i>=text.length){ clearInterval(t); cursor.remove(); scrollToBottom(false); resolve({span}); }
        }catch(e){ clearInterval(t); resolve({span}); }
      }, speed);
    });
  }
  function scrambleNode(node, duration=180){
    return new Promise(resolve=>{
      try{
        const text = node.textContent; let t=0, step=16;
        const charset = "01█░▒▓<>[]{}()|/\\#%$&*+-=~^•·!?@αβΞΩπ¥₿§¶∞≡∴∵∆µøØ✓";
        const timer = setInterval(()=>{
          t+=step; const amt=Math.min(1, t/duration); let out=''; const cut=1-amt;
          for(let i=0;i<text.length;i++){ if(text[i]===' '){ out+=' '; continue; } out += (i/text.length < cut) ? text[i] : charset[Math.floor(Math.random()*charset.length)]; }
          node.textContent = out;
          if(amt>=1){ clearInterval(timer); resolve(); }
        }, step);
      }catch(e){ resolve(); }
    });
  }

  /* Audio (guarded & skippable) */
  let ac, master, clickBus, hissBus, radioBus, subBus, noiseBuffer=null, tickTimer=null, crackleTimer=null;
  function safeAudio(onReady){
    if(SAFE){ onReady && onReady(false); return; }
    try{
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if(!Ctx){ onReady && onReady(false); return; }
      ac = new Ctx();
      master = ac.createGain(); master.gain.value=0.6; master.connect(ac.destination);
      clickBus = ac.createGain(); clickBus.gain.value=0; clickBus.connect(master);
      hissBus  = ac.createGain(); hissBus.gain.value=0.12; hissBus.connect(master);
      radioBus = ac.createGain(); radioBus.gain.value=0.0; radioBus.connect(master);
      subBus   = ac.createGain(); subBus.gain.value=0.0; subBus.connect(master);

      noiseBuffer = ac.createBuffer(1, ac.sampleRate, ac.sampleRate);
      const d = noiseBuffer.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;

      // Deep hiss that darkens over time
      const hissSrc = ac.createBufferSource(); hissSrc.buffer=noiseBuffer; hissSrc.loop=true;
      const hp = ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=180;
      const lp = ac.createBiquadFilter(); lp.type='lowpass';  lp.frequency.value=2400;
      hissSrc.connect(hp).connect(lp).connect(hissBus); hissSrc.start();
      setInterval(()=>{ if(!ac) return; hp.frequency.value=Math.max(60, hp.frequency.value-4); lp.frequency.value=Math.max(1200, lp.frequency.value-6); }, 2000);

      onReady && onReady(true);
    }catch(e){ onReady && onReady(false); }
  }
  function burst(vol=0.14, dur=0.08){
    try{
      if(!ac || !noiseBuffer) return;
      const src = ac.createBufferSource(); src.buffer = noiseBuffer;
      const g = ac.createGain(); g.gain.value = vol;
      src.connect(g).connect(clickBus);
      clickBus.gain.cancelScheduledValues(ac.currentTime);
      clickBus.gain.setValueAtTime(1, ac.currentTime);
      src.start(ac.currentTime);
      clickBus.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+dur);
    }catch(e){}
  }
  function subBoom(){
    try{
      if(!ac) return;
      const o = ac.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(52, ac.currentTime);
      const g = ac.createGain(); g.gain.value=0.0001;
      o.connect(g).connect(subBus);
      subBus.gain.setValueAtTime(1, ac.currentTime);
      g.gain.exponentialRampToValueAtTime(0.36, ac.currentTime+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.6);
      o.start(); o.stop(ac.currentTime+0.62);
    }catch(e){}
  }
  function thump(){ burst(0.3, 0.12); subBoom(); }

  /* Clock/crackle (visual tick even without audio) */
  function startClock(initialMs=820){ let ms=initialMs; function tick(){ burst(0.12,0.04); tickTimer=setTimeout(tick, ms); } tick(); return { setRate:(n)=>{ms=Math.max(50,n);}, stop:()=>{clearTimeout(tickTimer)} }; }
  function startCrackle(rateMs=1000){ function pop(){ if(Math.random()<0.85) burst(0.1+Math.random()*0.1, 0.03+Math.random()*0.06); crackleTimer=setTimeout(pop, rateMs*(0.5+Math.random()*0.9)); } pop(); }

  /* Orchestration */
  async function run(){
    initRain();
    const clockCtl = startClock(820);
    startCrackle(1000);

    // typing
    for(let idx=0; idx<lines.length; idx++){
      const last = (idx === lines.length - 1);
      const isSig = (lines[idx].trim() === "- x-X-x.");
      const spd  = last ? 60 : (idx===0 ? 86 : (idx>6 ? 60 : 72));
      const {span} = await typeLine(lines[idx], spd, last ? 0.14 : 0.18, isSig ? 'sig' : '');

      if(!last){
        if(span && span.textContent.trim()){ setTimeout(()=>scrambleNode(span, 220), 120); }
        await new Promise(r=>setTimeout(r, idx===0 ? 550 : 300));
      } else {
        if(isSig){
          [0,600,1200].forEach((t)=>{
            setTimeout(()=>{
              try{ span.classList.remove('neonPulse'); void span.offsetWidth; span.classList.add('neonPulse'); }catch(e){}
              thump();
            }, t);
          });
        }
        await new Promise(r=>setTimeout(r, 1400));
        await scrambleNode(span, 160);
        try{
          document.getElementById('termwrap').style.transition='opacity 420ms ease';
          document.getElementById('termwrap').style.opacity='0';
          document.getElementById('termwrap').style.pointerEvents='none';
        }catch(e){}
        setTimeout(()=>{ final.classList.add('show'); scanline.style.opacity='1'; }, 420);
      }
    }
  }

  /* Start after 1.5s; audio best-effort only */
  function arm(){
    try{
      if(document.body.dataset.started === "1") return;
      document.body.dataset.started = "1";
      safeAudio((ok)=>{
        try{ if(ac && ac.state === "suspended"){ ac.resume(); } }catch(e){}
        run();
      });
    }catch(e){ run(); }
  }
  setTimeout(arm, 1500);
  window.addEventListener('click', ()=>{ try{ if(ac && ac.state==='suspended') ac.resume(); }catch(e){} }, { once:true });

})();
</script>
</body>
</html>
